<!DOCTYPE html>
<html lang="he">

<!-- âœ… Include the head section -->
<%- include('partials/head') %>

<body>
    <!-- âœ… Include the navigation bar -->
    <%- include('partials/navbar') %>

    <!-- âœ… Main game details container -->
    <div class="game-container">

        <!-- âœ… Back button: Returns to either Home or Explore page -->
        <a href="<%= referer === 'home' ? '/' : '/games/explore' %>" class="back-btn">â¬… Back</a>

        <% if (!game) { %>
            <!-- âœ… If game data is missing, show an error message -->
            <h2>âš ï¸ Game not found</h2>
            <p>We couldn't retrieve the game details. Please try again later.</p>
        <% } else { %>
        
            <!-- âœ… Display game title -->
            <h1 class="game-title"><%= game.name %></h1>

            <!-- âœ… Game Image -->
            <div class="game-image-container">
                <img src="<%= game.image %>" alt="<%= game.name %>" class="game-image">
            </div>

            <!-- âœ… Game description and details -->
            <div class="game-description">
                <p><strong>ğŸ® Genre:</strong> <%= game.genre %></p>
                <p><strong>â­ Average Rating:</strong> <%= averageRating.toFixed(1) %> 
                (<%= totalRatings %> ratings)</p>
                <p><%= game.description %></p>
            </div>
            

            <% if (game.trailer) { %>
                <!-- âœ… Game Trailer -->
                <div class="game-video">
                    <h2>ğŸ¥ Trailer</h2>
                    <iframe width="100%" height="315" src="<%= game.trailer %>" frameborder="0" allowfullscreen></iframe>
                </div>
            <% } else { %>
                <!-- âœ… If no trailer is available, display a message -->
                <div class="game-video">
                    <h2>ğŸ¥ No Trailer Available</h2>
                </div>
            <% } %>

            <% if (game.gameplay) { %>
                <!-- âœ… Gameplay Video -->
                <div class="game-video">
                    <h2>ğŸ® Gameplay</h2>
                    <iframe width="100%" height="315" src="<%= game.gameplay %>" frameborder="0" allowfullscreen></iframe>
                </div>
            <% } else { %>
                <!-- âœ… If no gameplay video is available, display a message -->
                <div class="game-video">
                    <h2>ğŸ® No Gameplay Video Available</h2>
                </div>
            <% } %>

            <!-- âœ… Game Rating Section -->
            
            <div class="game-rating">
                <form id="ratingForm">
            
                    <!-- ğŸŒŸ ×“×™×¨×•×’ -->
                    <label for="ratingInput">Rate this game ğŸŒŸ</label>
                    <div class="rating-stars" id="starRating">
                        <span class="star" data-index="0">&#9733;</span>
                        <span class="star" data-index="1">&#9733;</span>
                        <span class="star" data-index="2">&#9733;</span>
                        <span class="star" data-index="3">&#9733;</span>
                        <span class="star" data-index="4">&#9733;</span>
                        <input type="hidden" id="ratingInput" name="rating" required>
                    </div>
                      
                      
                      
            
                    <!-- â±ï¸ ×©×¢×•×ª ××©×—×§ -->
                    <label for="playedHours">How many Hours did you spend on this game?â±ï¸</label>
                    <input type="number" id="playedHours" name="playedHours" placeholder="Example : 10" class="input" min="0" required>
            
                    <!-- ğŸ“ ×—×•×•×ª ×“×¢×ª -->
                    <label for="review">Write A ReviewğŸ“</label>
                    <textarea id="review" name="review" class="input" rows="4" placeholder="Say something you liked about this game.." required></textarea>
            
                    <!-- ğŸ’¾ ×›×¤×ª×•×¨ ×©×œ×™×—×” -->
                    <button type="submit" class="btn">Save RatingğŸ’¾</button>
            
                </form>
            </div>
            
            <% if (game.stores) { %>
                <!-- âœ… Button to check where to buy the game -->
                <p><a href="/games/<%= game.rawgId %>/stores" class="btn btn-buy">ğŸ›’ Purchase Links</a></p>
            <% } %>
        <% } %>

    </div>

    <!-- âœ… Include the footer section -->
    <%- include('partials/footer') %>

    <script>
        const GAME_ID = "<%= game.rawgId %>";
      </script>
      <script src="/js/gamerating.js" defer></script>
      
</body>

</html>
