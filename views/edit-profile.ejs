<%- include('partials/head') %>
<body>
<%- include('partials/navbar') %>

<div class="edit-profile-wrapper styled-box">

    <!-- ğŸ”¹ Sidebar -->
    <div class="edit-sidebar styled-box-inner">
        <ul>
            <li class="active" onclick="showSection(event, 'personal')">ğŸ‘¤ Personal Info</li>
            <li onclick="showSection(event, 'appearance')">ğŸ¨ Appearance</li>
            <li onclick="showSection(event, 'ratings')">â­ Ratings</li>
            <li onclick="showSection(event, 'security')">ğŸ”’ Security</li>
        </ul>
    </div>

    <!-- ğŸ”¹ Main Content -->
    <div class="edit-main-content styled-box-inner">
        <h2 class="edit-title">ğŸ› ï¸ Edit Profile</h2>

        <!-- âœ… Section: Personal Info -->
        <div id="section-personal" class="edit-section active">
            <!-- âœ… ×ª××•× ×” -->
            <form id="photoForm" action="/profile/update-photo" method="POST" enctype="multipart/form-data">
                <div class="profile-image-edit">
                    <img src="<%= user.profilePicture %>" alt="Profile Picture">
                    <label for="upload-photo"><i class="fas fa-pencil-alt"></i></label>
                    <input type="file" id="upload-photo" name="photo" accept="image/*" style="display:none;">
                </div>
            </form>

            <!-- âœ… ×”×•×“×¢×•×ª -->
            <% if (error) { %>
                <p class="error-message"><%= error %></p>
            <% } %>
            <% if (success) { %>
                <p class="success-message"><%= success %></p>
            <% } %>

            <!-- âœ… ×˜×•×¤×¡ ×¢×¨×™×›×” -->
            <form action="/profile/edit" method="POST" class="edit-form">
                <input type="text" name="username" value="<%= user.username || '' %>" placeholder="Username" required>
                <input type="text" name="fullName" value="<%= user.fullName || '' %>" placeholder="Full Name" required>
                <input type="date" name="birthday" value="<%= user.birthday ? new Date(user.birthday).toISOString().split('T')[0] : '' %>">
                <input type="text" name="phone" value="<%= user.phone || '' %>" placeholder="Phone (only digits)">
                <input type="text" name="favoriteGenre" value="<%= user.favoriteGenre || '' %>" placeholder="Favorite Genre">

                <div class="button-group">
                    <button type="submit" class="btn save">ğŸ’¾ Save Changes</button>
                    <a href="/profile" class="btn back">â¬…ï¸ Back to Profile</a>
                </div>
            </form>
        </div>

        <!-- âœ… Section: Appearance -->
        <div id="section-appearance" class="edit-section">
            <p>ğŸš§ Appearance editing coming soon</p>
        </div>

        <!-- âœ… Section: Ratings -->
        <div id="section-ratings" class="edit-section">
            <p>ğŸš§ Ratings overview coming soon</p>
        </div>

        <!-- âœ… Section: Security -->
        <div id="section-security" class="edit-section">
            <p>ğŸš§ Security settings coming soon</p>
        </div>
    </div>
</div>

<%- include('partials/footer') %>

<script>
    function showSection(event, sectionId) {
        document.querySelectorAll('.edit-section').forEach(div => div.classList.remove('active'));
        document.getElementById('section-' + sectionId).classList.add('active');

        document.querySelectorAll('.edit-sidebar li').forEach(li => li.classList.remove('active'));
        event.target.classList.add('active');
    }

    document.getElementById('upload-photo')?.addEventListener('change', function () {
        if (this.files.length > 0) {
            document.getElementById('photoForm').submit();
        }
    });
</script>

</body>
</html>
